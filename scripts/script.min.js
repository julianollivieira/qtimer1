var size=3,seqlen=23,numcub=5,mult=!1,cubeorient=!1,seq=[],posit=[];function parse(){var a=location.href.split("?");if(1<a.length){a=a[1].split("&");for(var b=0;b<a.length;b++){var e=a[b].split("=");"size"==e[0]?2<=e[1]-0&&(size=e[1]-0):"len"==e[0]?1<=e[1]-0&&(seqlen=e[1]-0):"num"==e[0]?1<=e[1]-0&&(numcub=e[1]-0):"multi"==e[0]?mult="on"==e[1]:"cubori"==e[0]?cubeorient="on"==e[1]:"col"==e[0]&&6==e[1].length&&(colorString=e[1])}}}parse();
function scramble(){var a=size;(mult||0!=(size&1))&&a--;var b=Array(a),e=[0,0,0];for(n=0;n<numcub;n++){var c=-1;for(seq[n]=[];seq[n].length<seqlen;){do var d=Math.floor(3*Math.random());while(d==c);for(c=0;c<a;c++)b[c]=0;var g=e[0]=e[1]=e[2]=0;do{do c=Math.floor(Math.random()*a);while(0!=b[c]);var f=Math.floor(3*Math.random());if(mult||a!=size||2*(e[f]+1)<a||2*(e[f]+1)==a&&0==e[0]+e[1]+e[2]-e[f])e[f]++,g++,b[c]=f+1}while(0==Math.floor(3*Math.random())&&g<a&&g+seq[n].length<seqlen);for(c=0;c<a;c++)if(b[c]){f=
b[c]-1;g=d;var k=c;c+c+1>=a&&(g+=3,k=a-1-k,f=2-f);seq[n][seq[n].length]=4*(6*k+g)+f}c=d}seq[n][seq[n].length]=cubeorient?Math.floor(24*Math.random()):0}flat2posit=Array(12*size*size);for(c=0;c<flat2posit.length;c++)flat2posit[c]=-1;for(c=0;c<size;c++)for(j=0;j<size;j++)flat2posit[4*size*(3*size-c-1)+size+j]=c*size+j,flat2posit[4*size*(size+c)+size-j-1]=(size+c)*size+j,flat2posit[4*size*(size+c)+4*size-j-1]=(2*size+c)*size+j,flat2posit[4*size*c+size+j]=(3*size+c)*size+j,flat2posit[4*size*(size+c)+
2*size+j]=(4*size+c)*size+j,flat2posit[4*size*(size+c)+size+j]=(5*size+c)*size+j}
function scramblestring(a){for(var b="",e,c=0;c<seq[a].length-1;c++){0!=c&&(b+=" &nbsp;");var d=seq[a][c]>>2;5>=size?b+="DLBURFdlburf".charAt(d):(e=d%6,d=(d-e)/6,b+="DLBURF".charAt(e),d&&(b+="<sub>"+(d+1)+"</sub>"));e=seq[a][c]&3;0!=e&&(b+=" 2'".charAt(e))}cubeorient&&(a=seq[a][seq[a].length-1],b="Top:"+colorList[2+colors[colorPerm[a][3]]]+"&nbsp;&nbsp;&nbsp;Front:"+colorList[2+colors[colorPerm[a][5]]]+"<br>"+b);return b}
function doslice(a,b,e){var c=size*size,d,g,f;5<a&&(a-=6);for(f=0;f<e;f++){for(d=0;d<size;d++){if(0==a){var k=6*c-size*b-size+d;var l=2*c-size*b-1-d;var p=3*c-size*b-1-d;var m=5*c-size*b-size+d}else 1==a?(k=3*c+b+size*d,l=3*c+b-size*(d+1),p=c+b-size*(d+1),m=5*c+b+size*d):2==a?(k=3*c+b*size+d,l=4*c+size-1-b+size*d,p=b*size+size-1-d,m=2*c-1-b-size*d):3==a?(k=4*c+b*size+size-1-d,l=2*c+b*size+d,p=c+b*size+d,m=5*c+b*size+size-1-d):4==a?(k=6*c-1-b-size*d,l=size-1-b+size*d,p=2*c+size-1-b+size*d,m=4*c-1-
b-size*d):5==a&&(k=4*c-size-b*size+d,l=2*c-size+b-size*d,p=c-1-b*size-d,m=4*c+b+size*d);var t=posit[k];posit[k]=posit[l];posit[l]=posit[p];posit[p]=posit[m];posit[m]=t}if(0==b)for(d=0;d+d<size;d++)for(g=0;g+g<size-1;g++)k=a*c+d+g*size,p=a*c+(size-1-d)+(size-1-g)*size,3>a?(l=a*c+(size-1-g)+d*size,m=a*c+g+(size-1-d)*size):(m=a*c+(size-1-g)+d*size,l=a*c+g+(size-1-d)*size),t=posit[k],posit[k]=posit[l],posit[l]=posit[p],posit[p]=posit[m],posit[m]=t}}var cb;
function showChartChange(){(cb=document.getElementById("showChartCheck").checked)?(writeTimeTableBox(document.getElementById("selectbox").value),document.getElementById("myChart").style.display="block"):document.getElementById("myChart").style.display="none"}function getStorage(){return JSON.parse(localStorage.getItem("QT_STORAGE"))}function setStorage(a){localStorage.setItem("QT_STORAGE",JSON.stringify(a))}
function addStorage(a){var b=getStorage();b.push(a);localStorage.setItem("QT_STORAGE",JSON.stringify(b))}function resetEntireStorage2(){confirm("Are you sure you want to clear all boxes?")&&(localStorage.setItem("QT_STORAGE",JSON.stringify([[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]])),writeTimeTableBox(selectbox.value))}
function resetEntireStorage(){localStorage.setItem("QT_STORAGE",JSON.stringify([[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]));}function clearOneBox(){var a=document.getElementById("selectbox"),b=a.value;if(confirm("Are you sure you want to clear box number "+b+" ?")){var e=getStorage();e[b]=[];localStorage.setItem("QT_STORAGE",JSON.stringify(e));writeTimeTableBox(a.value)}}
function getBox(a){try{return JSON.parse(localStorage.getItem("QT_STORAGE"))[a]}catch(b){return resetEntireStorage(),JSON.parse(localStorage.getItem("QT_STORAGE"))[a]}}function addToBox(a,b){var e=getStorage(),c=getBox(a);c.push(b);e[a]=c;localStorage.setItem("QT_STORAGE",JSON.stringify(e))}function deleteFromBox(a,b){if(confirm("Are you sure you want to delete number "+b+" ?")){var e=getStorage();e[a].splice(b-1,1);setStorage(e)}}
function exportStorageToFile(){var a=new Date;a=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"-"+a.getHours()+"_"+a.getMinutes();var b=document.createElement("a");b.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(getStorage())));b.setAttribute("download","Qtimer_"+a);b.style.display="none";document.body.appendChild(b);b.click();document.body.removeChild(b)}
function importStorageFromFile(){var a=document.createElement("input");a.type="file";a.onchange=function(a){a=a.target.files[0];var b=new FileReader;b.readAsText(a,"UTF-8");b.onload=function(a){localStorage.setItem("QT_STORAGE",a.target.result);a=document.getElementById("selectbox");writeTimeTableBox(a.value)}};a.click()}
function writeTimeTableBox(a){document.getElementById("ao5_text");document.getElementById("ao12_text");document.getElementById("mean_text");for(var b=document.getElementById("ao5_val"),e=document.getElementById("ao12_val"),c=document.getElementById("mean_val"),d=document.getElementById("myChart").getContext("2d"),g=document.getElementById("the_time_table");g.firstChild;)g.removeChild(g.firstChild);var f=getBox(a),k=[],l=[],p=[],m=[],t=[],u=0;f.forEach(function(a){k.push(f[u].time);t.push(u+1);u++});
var h=0;f.forEach(function(a){h++;var u=document.importNode(tablerow_template.content,!0),r=u.querySelectorAll("td"),q="-",v="-";try{v=((f[h-1].time+f[h-2].time+f[h-3].time+f[h-4].time+f[h-5].time)/5).toFixed(2)}catch(w){}try{q=((f[h-1].time+f[h-2].time+f[h-3].time+f[h-4].time+f[h-5].time+f[h-6].time+f[h-7].time+f[h-8].time+f[h-9].time+f[h-10].time+f[h-11].time+f[h-12].time)/12).toFixed(2)}catch(w){}var x=0,y=0;f.forEach(function(a){x+=a.time;y++});var z=0;f.slice(0,h).forEach(function(a){z+=a.time});
m.push((z/h).toFixed(2));b.innerHTML=v;e.innerHTML=q;c.innerHTML=(x/y).toFixed(2);l.push(v);p.push(q);r[0].textContent=h;r[1].textContent=a.time.toFixed(2);r[2].textContent=v;r[3].textContent=q;r[0].setAttribute("onClick","javascript: showScramble("+h+")");r[1].setAttribute("onClick","javascript: showScramble("+h+")");r[2].setAttribute("onClick","javascript: showScramble("+h+")");r[3].setAttribute("onClick","javascript: showScramble("+h+")");r[4].setAttribute("onClick","javascript: deleteTime("+h+
")");g.insertBefore(u,g.firstChild);if(cb){try{myChart.destroy()}catch(w){}myChart=new Chart(d,{type:"line",data:{labels:t,datasets:[{fill:!1,label:"Time",data:k,borderColor:["rgba(255, 99, 132, 1)"],borderWidth:1},{fill:!1,label:"AO5",data:l,borderColor:["rgba(99, 255, 132, 1)"],borderWidth:1},{fill:!1,label:"AO12",data:p,borderColor:["rgba(132, 99, 255, 1)"],borderWidth:1},{fill:!1,label:"Mean",data:m,borderColor:["rgba(80, 80, 80, 1)"],borderWidth:1}]},options:{elements:{line:{tension:0}},responsive:!1,
animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0,scales:{yAxes:[{ticks:{beginAtZero:!1}}]}}})}});a=document.importNode(tablerow_template.content,!0);var q=a.querySelectorAll("td");q[0].textContent="No.";q[1].textContent="Time";q[2].textContent="AO5";q[3].textContent="AO12";q[4].textContent="Del";g.insertBefore(a,g.firstChild)}function onSelectBoxChange(){var a=document.getElementById("selectbox");writeTimeTableBox(a.value)}
function deleteTime(a){var b=document.getElementById("selectbox");deleteFromBox(b.value,a);writeTimeTableBox(b.value)}function updateScramble(){var a=document.getElementById("scramble");scramble();a.innerHTML=scramblestring(0)}function showScramble(a){var b=document.getElementById("selectbox");currentBox=getBox(b.value);b=currentBox[a-1].scramble;b.includes("&nbsp;")&&(b=b.replace(/&nbsp;/g,""));alert("Scramble for solve No. "+a+" ("+currentBox[a-1].time+")\n "+b)}
window.onload=function(){function a(a){return 9<a?""+a:"0"+a}function b(){document.getElementById("the_timer").innerHTML=a(g)+":"+a(f)+"."+a(k/10);k+=10;1E3==k&&(f+=1,k=0);60==f&&(g+=1,f=0)}function e(){!1===l?(k=f=g=0,p=setInterval(b,10),l=!0):(clearInterval(p),l=!1)}var c=document.getElementById("main");cb=document.getElementById("showChartCheck").checked;var d=document.getElementById("selectbox");writeTimeTableBox(d.value);updateScramble();var g=0,f=0,k=0,l=!1,p,m=!1;window.onkeyup=function(a){32==
a.keyCode&&!1===l&&(m?m=!1:(e(),document.getElementById("showTimerCheck").checked&&(document.getElementById("the_timer").style.visibility="hidden"),document.getElementById("showUI").checked&&(document.getElementById("left_bar").style.visibility="hidden",document.getElementById("top_bar").style.visibility="hidden",document.getElementById("myChart").style.visibility="hidden",document.getElementById("stats").style.visibility="hidden")))};window.onkeydown=function(a){if(32==a.keyCode&&!0===l){e();document.getElementById("showTimerCheck").checked&&
(document.getElementById("the_timer").style.visibility="visible");document.getElementById("showUI").checked&&(document.getElementById("left_bar").style.visibility="visible",document.getElementById("top_bar").style.visibility="visible",document.getElementById("myChart").style.visibility="visible",document.getElementById("stats").style.visibility="visible");m=!0;a=parseFloat(document.getElementById("the_timer").innerHTML.split(":")[1]);var b=document.getElementById("scramble").innerHTML.replace(/&nbsp;/g,
"");addToBox(d.value,{time:a,scramble:b});cb=document.getElementById("showChartCheck").checked;writeTimeTableBox(d.value);updateScramble()}};c.ontouchend=function(a){!1===l&&(m?m=!1:e())};c.ontouchstart=function(a){if(!0===l){e();m=!0;a=parseFloat(document.getElementById("the_timer").innerHTML.split(":")[1]);var b=document.getElementById("scramble").innerHTML;addToBox(d.value,{time:a,scramble:b});writeTimeTableBox(d.value);updateScramble()}}};
